})))
distance_list_total
is.nan(NaN)
which(unlist(
lapply(seq_along(distance_list_total), function(i){
browser()
any(is.nan(unlist(distance_list[[i]])))
#any(unlist(distance_list[[i]])=="NaN")
})))
unlist(distance_list[[i]])
is.nan(unlist(distance_list[[i]]))
which(unlist(
lapply(seq_along(distance_list_total), function(i){
any(is.nan(unlist(distance_list[[i]])))
#any(unlist(distance_list[[i]])=="NaN")
})))
distance_list_total
is.nan(NaN)
which(unlist(
lapply(seq_along(distance_list_total), function(i){
any(is.nan(unlist(distance_list_total[[i]])))
#any(unlist(distance_list[[i]])=="NaN")
})))
which(unlist(
lapply(seq_along(distance_list), function(i){
any(is.nan(unlist(distance_list[[i]])))
#any(unlist(distance_list[[i]])=="NaN")
})))
which(unlist(
lapply(seq_along(distance_list_total), function(i){
any(is.nan(unlist(distance_list_total[[i]])))
#any(unlist(distance_list[[i]])=="NaN")
})))
devtools::document()
distance_list_total <- integrate_distance(distance_list[1])
ref_Virus
result_list
result_list2
result_list
D_list
lapply(seq_along(result_list), function(i){
titers <- result_list[[i]]
titers <- titers[!is.na(titers)]
test_freq <- table(names(titers))
multi_ti <- names(test_freq[test_freq > 1])
if(length(multi_ti) == 0)
return(titers)
multi_value <- unlist(
lapply(seq_along(multi_ti),function(i){
test_V <- multi_ti[i]
mean(titers[titers == test_V])
}))
names(multi_value) <- multi_ti
titers <- c(titers[!names(titers) %in% multi_ti],multi_value)
return(titers)
})
?mean
devtools::document()
distance_list_total <- integrate_distance(distance_list)
distance_list_total
distance_list
which(unlist(
lapply(seq_along(distance_list_total), function(i){
#any(is.nan(unlist(distance_list_total[[i]])))
#any(unlist(distance_list[[i]])=="NaN")
any(is.numeric(unlist(distance_list_total[[i]])))
})))
which(unlist(
lapply(seq_along(distance_list_total), function(i){
#any(is.nan(unlist(distance_list_total[[i]])))
#any(unlist(distance_list[[i]])=="NaN")
any(!is.numeric(unlist(distance_list_total[[i]])))
})))
mean(c(NA,NA),na.rm=TRUE)
which(unlist(
lapply(seq_along(distance_list), function(i){
#any(is.nan(unlist(distance_list_total[[i]])))
#any(unlist(distance_list[[i]])=="NaN")
#any(!is.numeric(unlist(distance_list_total[[i]])))
is.na(distance_list[[i]])
})))
devtools::document()
distance_list_total <- integrate_distance(distance_list)
distance_list_total <- integrate_distance(distance_list)
devtools::document()
distance_list_total <- integrate_distance(distance_list)
devtools::document()
distance_list_total <- integrate_distance(distance_list)
ref_Virus
lapply(seq_along(result_list), function(i){
print(i)
browser()
titers <- result_list[[i]]
titers <- titers[!is.na(titers)]
test_freq <- table(names(titers))
multi_ti <- names(test_freq[test_freq > 1])
if(length(multi_ti) == 0)
return(titers)
multi_value <- unlist(
lapply(seq_along(multi_ti),function(i){
test_V <- multi_ti[i]
mean(titers[titers == test_V],na.rm=TRUE)
}))
names(multi_value) <- multi_ti
titers <- c(titers[!names(titers) %in% multi_ti],multi_value)
if(any(is.nan(titers)))
stop("fuck!")
return(titers)
})
result_list[[i]]
titers
test_freq
multi_ti
unlist(
lapply(seq_along(multi_ti),function(i){
test_V <- multi_ti[i]
mean(titers[titers == test_V],na.rm=TRUE)
}))
multi_ti
multi_value <- unlist(
lapply(seq_along(multi_ti),function(i){
browser()
test_V <- multi_ti[i]
mean(titers[titers == test_V],na.rm=TRUE)
}))
multi_ti[i]
titers
test_V
multi_value <- unlist(
lapply(seq_along(multi_ti),function(i){
test_V <- multi_ti[i]
mean(titers[names(titers) == test_V],na.rm=TRUE)
}))
multi_value
devtools::document()
distance_list_total <- integrate_distance(distance_list)
which(unlist(
lapply(seq_along(distance_list_total), function(i){
any(is.nan(unlist(distance_list_total[[i]])))
#any(unlist(distance_list[[i]])=="NaN")
#any(!is.numeric(unlist(distance_list_total[[i]])))
#is.na(distance_list[[i]])
})))
distance_list_total
Ref <- names(dist_list)
data4model(distance_list_total,GISAID_H3N2,"H3")
data4model <- function(dist_list,GISAID_ref,type){
}
data4model <- function(dist_list,GISAID_ref,type){
browser()
reference_id <- c()
reference_seq <- c()
candidate_id <- c()
candidate_seq <- c()
value <- c()
Ref <- names(dist_list)
for(i in seq_along(Ref)){
Test <- dist_list[[i]]
reference_id <- c(reference_id,rep(paste0(type,Ref),length(dist_list[[i]])))
reference_seq <- c(reference_seq,rep(GISAID_ref[[2]][as.numeric(Ref[i])]))
candidate_id <- c(candidate_id,paste0(type,names(dist_list[[i]]))
candidate_seq <- c(candidate_seq,GISAID_ref[[2]][as.numeric(names(Test))])
data4model <- function(dist_list,GISAID_ref,type){
browser()
reference_id <- c()
reference_seq <- c()
candidate_id <- c()
candidate_seq <- c()
value <- c()
Ref <- names(dist_list)
for(i in seq_along(Ref)){
Test <- dist_list[[i]]
reference_id <- c(reference_id,rep(paste0(type,Ref),length(dist_list[[i]])))
reference_seq <- c(reference_seq,rep(GISAID_ref[[2]][as.numeric(Ref[i])]))
candidate_id <- c(candidate_id,paste0(type,names(dist_list[[i]])))
candidate_seq <- c(candidate_seq,GISAID_ref[[2]][as.numeric(names(Test))])
}
}
data4model(distance_list_total,GISAID_H3N2,"H3")
reference_id
reference_seq
data4model <- function(dist_list,GISAID_ref,type){
browser()
reference_id <- c()
reference_seq <- c()
candidate_id <- c()
candidate_seq <- c()
value <- c()
Ref <- names(dist_list)
for(i in seq_along(Ref)){
Test <- dist_list[[i]]
reference_id <- c(reference_id,rep(paste0(type,Ref),length(dist_list[[i]]),length(Test)))
reference_seq <- c(reference_seq,rep(GISAID_ref[[2]][as.numeric(Ref[i])]))
candidate_id <- c(candidate_id,paste0(type,names(dist_list[[i]])))
candidate_seq <- c(candidate_seq,GISAID_ref[[2]][as.numeric(names(Test))])
}
}
data4model(distance_list_total,GISAID_H3N2,"H3")
reference_id
data4model <- function(dist_list,GISAID_ref,type){
browser()
reference_id <- c()
reference_seq <- c()
candidate_id <- c()
candidate_seq <- c()
value <- c()
Ref <- names(dist_list)
for(i in seq_along(Ref)){
Test <- dist_list[[i]]
reference_id <- c(reference_id,rep(paste0(type,Ref),length(dist_list[[i]])))
reference_seq <- c(reference_seq,rep(GISAID_ref[[2]][as.numeric(Ref[i])],length(Test)))
candidate_id <- c(candidate_id,paste0(type,names(dist_list[[i]])))
candidate_seq <- c(candidate_seq,GISAID_ref[[2]][as.numeric(names(Test))])
}
}
data4model(distance_list_total,GISAID_H3N2,"H3")
reference_id
rep(paste0(type,Ref),length(dist_list[[i]])
)
Ref
data4model <- function(dist_list,GISAID_ref,type){
browser()
reference_id <- c()
reference_seq <- c()
candidate_id <- c()
candidate_seq <- c()
value <- c()
Ref <- names(dist_list)
for(i in seq_along(Ref)){
Test <- dist_list[[i]]
reference_id <- c(reference_id,rep(paste0(type,Ref[i]),length(dist_list[[i]])))
reference_seq <- c(reference_seq,rep(GISAID_ref[[2]][as.numeric(Ref[i])],length(Test)))
candidate_id <- c(candidate_id,paste0(type,names(dist_list[[i]])))
candidate_seq <- c(candidate_seq,GISAID_ref[[2]][as.numeric(names(Test))])
}
}
data4model(distance_list_total,GISAID_H3N2,"H3")
reference_id
reference_seq
candidate_id
candidate_seq
data4model <- function(dist_list,GISAID_ref,type){
browser()
reference_id <- c()
reference_seq <- c()
candidate_id <- c()
candidate_seq <- c()
value <- c()
Ref <- names(dist_list)
for(i in seq_along(Ref)){
Test <- dist_list[[i]]
reference_id <- c(reference_id,rep(paste0(type,Ref[i]),length(dist_list[[i]])))
reference_seq <- c(reference_seq,rep(GISAID_ref[[2]][as.numeric(Ref[i])],length(Test)))
candidate_id <- c(candidate_id,paste0(type,names(dist_list[[i]])))
candidate_seq <- c(candidate_seq,GISAID_ref[[2]][as.numeric(names(Test))])
value <- c(value,Test)
}
}
data4model(distance_list_total,GISAID_H3N2,"H3")
data4model <- function(dist_list,GISAID_ref,type){
browser()
reference_id <- c()
reference_seq <- c()
candidate_id <- c()
candidate_seq <- c()
value <- c()
Ref <- names(dist_list)
for(i in seq_along(Ref)){
Test <- dist_list[[i]]
reference_id <- c(reference_id,rep(paste0(type,Ref[i]),length(dist_list[[i]])))
reference_seq <- c(reference_seq,rep(GISAID_ref[[2]][as.numeric(Ref[i])],length(Test)))
candidate_id <- c(candidate_id,paste0(type,names(dist_list[[i]])))
candidate_seq <- c(candidate_seq,GISAID_ref[[2]][as.numeric(names(Test))])
value <- c(value,Test)
}
result <- data.frame(reference_id,reference_seq,candidate_id,candidate_seq,value)
}
data4model <- function(dist_list,GISAID_ref,type){
reference_id <- c()
reference_seq <- c()
candidate_id <- c()
candidate_seq <- c()
value <- c()
Ref <- names(dist_list)
for(i in seq_along(Ref)){
Test <- dist_list[[i]]
reference_id <- c(reference_id,rep(paste0(type,Ref[i]),length(dist_list[[i]])))
reference_seq <- c(reference_seq,rep(GISAID_ref[[2]][as.numeric(Ref[i])],length(Test)))
candidate_id <- c(candidate_id,paste0(type,names(dist_list[[i]])))
candidate_seq <- c(candidate_seq,GISAID_ref[[2]][as.numeric(names(Test))])
value <- c(value,Test)
}
result <- data.frame(reference_id,reference_seq,candidate_id,candidate_seq,value)
}
data <- data4model(distance_list_total,GISAID_H3N2,"H3")
View(data4model())
View(data4model)
View(data)
data$value <- as.numeric(data$value)
View(data)
H3_distance <- antigenic_Distance(H3N2_list2)
H3_distance <- antigenic_Distance(H3N2_list2)
H3_dist_all <- integrate_distance(H3_dist_all)
H3_dist_all <- integrate_distance(H3_distance)
H3_df <- data4model(distance_list_total,GISAID_H3N2,"H3")
H1N1_list1 <- rm_redundant_col(H1N1_list)
H1N1_list2 <- titer_standardization(H1N1_list1)
H1_distance <- antigenic_Distance(H1N1_list2)
H1_dist_all <- integrate_distance(H1_distance)
H3_df <- data4model(H3_dist_all,GISAID_H3N2,"H3")
H1_df <- data4model(H1_dist_all,GISAID_H1N1,"H1")
final_df <- rbind(H3_df,H1_df)
write.csv(final_df,file = "C:/Users/19177/Desktop/data4model(dist).csv")
?write.csv
write.csv(final_df,file = "C:/Users/19177/Desktop/data4model(dist).csv",row.names = FALSE)
Victoria_final
vect <- c()
for(i in seq_along(final_df$candidate_id)){
vect <- c(vect,final_df$candidate_id[i],final_df$candidate_seq)
}
vect <- c()
for(i in seq_along(final_df$candidate_id)){
vect <- c(vect,paste0(">",final_df$candidate_id[i]),final_df$candidate_seq)
}
vect <- c()
candi <- paste0(">",final_df$candidate_id
vect <- c(vect,candi[i],final_df$candidate_seq[i])
vect <- c()
candi <- paste0(">",final_df$candidate_id)
for(i in seq_along(final_df$candidate_id)){
vect <- c(vect,candi[i],final_df$candidate_seq[i])
}
vect <- rep(0,2*length(final_df$candidate_id))
?seq
vect[seq(from=1,by=2,length.out=length(vect)/2)] <- final_df$candidate_id
vect <- rep(0,2*length(final_df$candidate_id))
vect[seq(from=1,by=2,length.out=length(vect)/2)] <- final_df$candidate_id
vect[seq(from=2,by=2,length.out=length(vect)/2)] <- final_df$candidate_seq
vect
vect <- rep(0,2*length(final_df$candidate_id))
candi <- paste0(">",final_df$candidate_id)
vect[seq(from=1,by=2,length.out=length(vect)/2)] <- candi
vect[seq(from=2,by=2,length.out=length(vect)/2)] <- final_df$candidate_seq
writeLines(vect,con = "C:/Users/19177/Desktop/Dist.fasta")
any(is.na(vect))
seq(from=1,by=2,length.out=length(vect)/2)
vect
which(vect == ">H347852")
vect[which(vect == ">H347852")]
vect[which(vect == ">H347852") + 1]
final_df[final_df$candidate_id == "H347852",]
View(final_df[final_df$candidate_id == "H347852",])
H3_df[H3_df$candidate_id == "H347852",]
H3_dist_all
GISAID_H3N2[[1]]
GISAID_H3N2[[1]][47852,]
View(GISAID_H3N2[[1]][47852,])
View(GISAID_H3N2[[2]][47852])
View(GISAID_H3N2[[2]][47852])
View(GISAID_H3N2[[1]][47852,])
final_df == ""
final_df <- final_df[!final_df == ""]
final_df
final_df <- rbind(H3_df,H1_df)
final_df
!final_df == ""
final_df[!final_df == ""]
apply(final_df,1,function(x){
if(any(x == ""))
return(FALSE)
else
return(TRUE)
})
sel_row <-
apply(final_df,1,function(x){
if(any(x == ""))
return(FALSE)
else
return(TRUE)
})
sel_row
final_df <- final_df[sel_row,]
saveFasta(path = "C:/Users/19177/Desktop/B/Victoria.fasta",Victoria_final,GISAID_Victoria)
vect <- rep(0,2*length(final_df$candidate_id))
candi <- paste0(">",final_df$candidate_id)
vect[seq(from=1,by=2,length.out=length(vect)/2)] <- candi
vect[seq(from=2,by=2,length.out=length(vect)/2)] <- final_df$candidate_seq
writeLines(vect,con = "C:/Users/19177/Desktop/Dist.fasta")
candidate_id
seqs <- unique(final_df$candidate_id)
seqs
vect <- rep(0,2*length(seqs))
candi <- paste0(">",seqs)
vect[seq(from=1,by=2,length.out=length(vect)/2)] <- candi
vect <- rep(0,2*length(final_df$candidate_id))
candi <- paste0(">",final_df$candidate_id)
vect[seq(from=1,by=2,length.out=length(vect)/2)] <- candi
vect[seq(from=2,by=2,length.out=length(vect)/2)] <- final_df$candidate_seq
df <- final_df
df <- final_df[,c(3,4)]
df
View(df)
unique_rows <- !duplicated(df$candidate_id)
unique_rows
# 仅保留唯一行
df_unique <- df[unique_rows, ]
# 仅保留唯一行
df_unique <- df[unique_rows, ]
vect <- rep(0,2*length(df_unique$candidate_id))
candi <- paste0(">",df_unique$candidate_id)
vect[seq(from=1,by=2,length.out=length(vect)/2)] <- candi
vect[seq(from=2,by=2,length.out=length(vect)/2)] <- df_unique$candidate_seq
writeLines(vect,con = "C:/Users/19177/Desktop/Dist.fasta")
df <- final_df
unique_rows <- !duplicated(df$candidate_id)
# 仅保留唯一行
df_unique <- df[unique_rows, ]
View(df_unique)
H3_dist_all
seq_names <- c(final_df$reference_id,final_df$candidate_id)
seq_content <- c(final_df$reference_seq,final_df$candidate_seq)
df <- data.frame(seq_names,seq_content)
unique_rows <- !duplicated(df$seq_names)
unique_rows
df <- df[unique_rows,]
dim(df)
View(df)
seqs_fasta <- c()
for (i in seq_along(df[,1])) {
seqs_fasta <- c(df[i,1],df[i,2])
}
seqs_fasta <- c()
for (i in seq_along(df[,1])) {
seqs_fasta <- c(seqs_fasta,df[i,1],df[i,2])
}
seqs_fasta
writeLines(seqs_fasta,con = "C:/Users/19177/Desktop/Dist.fasta")
seqs_fasta <- c()
for (i in seq_along(df[,1])) {
seqs_fasta <- c(seqs_fasta,paste0(">",df[i,1]),df[i,2])
}
writeLines(seqs_fasta,con = "C:/Users/19177/Desktop/Dist.fasta")
ref_fasta <- readLines(con = "C:/Users/19177/Desktop/Dist_alignment.fasta")
ref_fasta
read_sequences("C:/Users/19177/Desktop/Dist_alignment.fasta","AA")
class(ref_fasta)
ref_fasta <- read_sequences("C:/Users/19177/Desktop/Dist_alignment.fasta","AA")
ref_fasta
ref_fasta[[1]]
apply(final_df, 1, function(x){
ref <- x[1]
ref_idx <- which(ref_fasta[[1]] == ref)
x[2] <- ref_fasta[[2]][ref_idx]
test <- x[3]
test_idx <- which(test_fasta[[1]] == test)
x[4] <- ref_fasta[[2]][test_idx]
})
dd <-
apply(final_df, 1, function(x){
ref <- x[1]
ref_idx <- which(ref_fasta[[1]] == ref)
x[2] <- ref_fasta[[2]][ref_idx]
test <- x[3]
test_idx <- which(ref_fasta[[1]] == test)
x[4] <- ref_fasta[[2]][test_idx]
})
dd <-
apply(final_df, 1, function(x){
ref <- x[1]
ref_idx <- which(ref_fasta[[1]] == ref)
x[2] <- ref_fasta[[2]][ref_idx]
test <- x[3]
test_idx <- which(ref_fasta[[1]] == test)
x[4] <- ref_fasta[[2]][test_idx]
return(x)
})
dd
View(dd)
dd <- t(
apply(final_df, 1, function(x){
ref <- x[1]
ref_idx <- which(ref_fasta[[1]] == ref)
x[2] <- ref_fasta[[2]][ref_idx]
test <- x[3]
test_idx <- which(ref_fasta[[1]] == test)
x[4] <- ref_fasta[[2]][test_idx]
return(x)
}))
View(dd)
View(dd)
final_df_alignment <- t(
apply(final_df, 1, function(x){
ref <- x[1]
ref_idx <- which(ref_fasta[[1]] == ref)
x[2] <- ref_fasta[[2]][ref_idx]
test <- x[3]
test_idx <- which(ref_fasta[[1]] == test)
x[4] <- ref_fasta[[2]][test_idx]
return(x)
}))
final_df_alignment <- t(
apply(final_df, 1, function(x){
ref <- x[1]
ref_idx <- which(ref_fasta[[1]] == ref)
x[2] <- ref_fasta[[2]][ref_idx]
test <- x[3]
test_idx <- which(ref_fasta[[1]] == test)
x[4] <- ref_fasta[[2]][test_idx]
return(x)
}))
write.csv(final_df_alignment,file = "C:/Users/19177/Desktop/data4model(alignment).csv",
row.names = FALSE)
